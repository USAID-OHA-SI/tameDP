<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Running tameDP to extract targets
">
<title>Extracting Targets • tameDP</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extracting Targets">
<meta property="og:description" content="Running tameDP to extract targets
">
<meta property="og:image" content="https://usaid-oha-si.github.io/tameDP/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tameDP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">6.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/setup.html">Setup</a>
    <a class="dropdown-item" href="../articles/extracting-targets.html">Extracting Targets</a>
    <a class="dropdown-item" href="../articles/combining-with-msd.html">Combining with the MSD</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USAID-OHA-SI/tameDP/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Extracting Targets</h1>
            
      
      
      <div class="d-none name"><code>extracting-targets.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>This vignette provides an overview for extracting targets and other
data using <code>tameDP</code>. You’ll learn about the different
parameters to extract different components of the COP Target Setting
Tool.</p>
</div>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>If you haven’t installed R or <code>tameDP</code>, you should first
refer to the <a href="setup.html">Setup vignette</a>.</p>
<p>Once you have everything installed, you will want to launch R or
RStudio (an IDE for R). To use <code>tameDP</code> you will need to load
it into your working environment. Enter the line below into your console
to initiate the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usaid-oha-si.github.io/tameDP/">tameDP</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="storing-the-file-path">Storing the File Path<a class="anchor" aria-label="anchor" href="#storing-the-file-path"></a>
</h3>
<p>The first thing you will want to do after your load
<code>tameDP</code> is to tell R where your Target Setting Tool is
located on your computer. In your Windows Explorer (outside of R),
navigate to your Target Setting Tool file, and hold the SHIFT key while
you right click on the file name. Doing this gives you an additional
option to “Copy as path”, which you want to click.</p>
<p>Now you have the path saved to your clipboard. Open your R up and
paste the copied filepath into the Console or a script. Before you hit
enter, you will need to store this path as an object in R using the
assignment operator <code>&lt;-</code>. This let’s us store information
to use at a later point to pass into different functions. We will call
the object, <code>dp_filepath</code>. <strong>It is important to note
that Windows filepaths have their slash in the wrong direction. You will
need to replace all backslashes (“/") in your filepath with forward
slashes (”/“).</strong> The command to store the file path object will
look like the code below, where you have replaced the file path with the
path to your own file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dp_filepath</span> <span class="op">&lt;-</span> <span class="st">"C:/Users/[username]/Downloads/DataPack_Jupiter_20500101.xlsx"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extracting-targets">Extracting Targets<a class="anchor" aria-label="anchor" href="#extracting-targets"></a>
</h3>
<p>There are a few different forms of data we can get out of the Target
Setting Tool. The first is extracting all the targets from their
relevant tabs. The data here will be at the PSNU level, broken out by
the relevant disagregates (e.g. Age/Sex/HIVStatus). In the function
below, we have used the filepath we stored above to pass that into the
function. <em>This function will take a few seconds or minutes to run
depending on the size of your Target Setting Tool.</em></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tame_dp.html">tame_dp</a></span><span class="op">(</span><span class="va">dp_filepath</span><span class="op">)</span></span></code></pre></div>
<p>The data that has been extracted from the Target Setting Tool will
stored in an objected called <code>df_dp</code>. If you browse the data
frame (df) using a function like <code>View(df_dp)</code> or
<code>dplyr::glimpse(df_dp)</code>, you’ll see the structure is very
similar to a MER Structured Dataset (MSD). You have the following
columns:
<code>operatingunit, countryname, snu1, psnu, psnuuid, fiscal_year, indicator, standardizeddisaggregate, numeratordenom, ageasentered, sex, modality, statushiv, otherdisaggregate, targets</code>.
The output is a bit more manageable to work with than using it in the
Target Setting Tool.</p>
</div>
<div class="section level3">
<h3 id="other-data-options">Other Data Options<a class="anchor" aria-label="anchor" href="#other-data-options"></a>
</h3>
<p>In the function above, we provided the filepath and the function
returned the the data frame of targets from the Target Setting Tool.
Function in R often have multiple parameters. Take a minute to look at
the help file for <code><a href="../reference/tame_dp.html">tame_dp()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">tame_dp</span></span></code></pre></div>
<p>We can see that there are different parameter that will allow us to
return different things.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tame_dp.html">tame_dp</a></span><span class="op">(</span><span class="va">filepath</span>, type <span class="op">=</span> <span class="st">"ALL"</span>, map_names <span class="op">=</span> <span class="cn">FALSE</span>, psnu_lvl <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>By default, the function is returning a specific <code>type</code>
and is <code>FALSE</code> for the other two parameters. If you look in
the help file, you will see there are three options for
<code>type</code> - “PSNUxIM”, “PLHIV”, “ALL” (the default) or a
specific tab. The option for using “ALL” is giving us all the targets
from the tabs. But you will see that you could change this option to
“PLHIV”. If you do, it will return the PLHIV and NAT_SUBNAT data from
the Cascade tab of the Target Setting Tool. The function will be the
same structure as above, but we are adding the <code>type</code>
parameter in order to return the PLHIV and NAT_SUBNAT data instead of
targets.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#return IMPATT/SUBNAT data</span></span>
<span><span class="va">df_subnat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tame_subnat.html">tame_subnat</a></span><span class="op">(</span><span class="va">dp_filepath</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#return data from a specific tab - TB</span></span>
<span><span class="va">df_tb</span> <span class="op">&lt;-</span> <span class="fu">tamep_dp</span><span class="op">(</span><span class="va">dp_filepath</span>, type <span class="op">=</span> <span class="st">"TB"</span><span class="op">)</span></span></code></pre></div>
<p>The structure of the data frame is the same as when we ran it for
targets, but the difference is in the indicators returned
(<code>indicator</code>).</p>
<p>Last but not least we have the option to return
<code>type = "PSNUxIM"</code>, which will pull data from the PSNUxIM tab
of the Target Setting Tool (or OPU). As the tab name and
<code>type</code> indicate, the data will be at the PSNU and mechanism
level.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_dp_mech</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tame_dp.html">tame_dp</a></span><span class="op">(</span><span class="va">dp_filepath</span>, type <span class="op">=</span> <span class="st">"PSNUxIM"</span><span class="op">)</span></span></code></pre></div>
<p>This last <code>type</code> option returns the <code>mech_code</code>
in the Target Setting Tool with the targets assigned to it. The Target
Setting Tool doesn’t include the mechanism name or prime partner so
these columns are left blank. To include this info, you can set
<code>map_names = TRUE</code> in your function. When you run the
function, there will be a pop-up window asking you to type your DATIM
user name and password to pull this information down from DATIM.
Previously, this had been public information, but after a DHIS2 update,
the data became password protected.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_dp_mech_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tame_dp.html">tame_dp</a></span><span class="op">(</span><span class="va">dp_filepath</span>, type <span class="op">=</span> <span class="st">"PSNUxIM"</span>, map_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The final parameter in the function is <code>psnu_lvl</code> which
gives the user the option to aggregate the data up to the PSNU level (if
working with PSNUxIM). Since <code>tame_dp</code> can pull from the
target tabs which are at the PSNU level, this isn’t as useful now, but
it can be useful if you are only working with the PSNUxIM tab, such as
with an OPU.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_dp_psnu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tame_dp.html">tame_dp</a></span><span class="op">(</span><span class="va">dp_filepath</span>, type <span class="op">=</span> <span class="st">"PSNUxIM"</span>, psnu_lvl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="combining-multiple-files">Combining Multiple Files<a class="anchor" aria-label="anchor" href="#combining-multiple-files"></a>
</h3>
<p>You can use one of the <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> functions from
<code>purrr</code> package to read in multiple Target Setting Tools and
combine rather than working with one off. This may be more relevant if
you’re reviewing a regional operating unit or in Washington. You will
get a pop up each time to provide your DATIM credentials if you don’t
have stored in the session. We recommend using
<code><a href="https://rdrr.io/pkg/askpass/man/askpass.html" class="external-link">askpass::askpass()</a></code> when storing your credentials so you
don’t type into your script or into your console (and visual under
history).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#load package</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#identify all the Target Setting Tool files</span></span>
<span>  <span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"../Downloads/DataPacks"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#read in all DPs and combine into one data frame</span></span>
<span>  <span class="va">df_combo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">files</span>,</span>
<span>                      .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/tame_dp.html">tame_dp</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span></span>
<span>                    </span>
<span><span class="co">#store DATIM credentials</span></span>
<span>  <span class="va">dtm_usr</span> <span class="op">&lt;-</span> <span class="st">"spower"</span> <span class="co">#replace with your credentials</span></span>
<span>  <span class="va">dtm_pwd</span> <span class="op">&lt;-</span> <span class="fu">getPass</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/getPass/man/getPass.html" class="external-link">getPass</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#pop up prompting for your password</span></span>
<span>  </span>
<span><span class="co">#apply mech_name and primepartner names from DATIM</span></span>
<span>  <span class="va">df_combo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_names.html">get_names</a></span><span class="op">(</span><span class="va">df_combo</span>, datim_user <span class="op">=</span> <span class="va">dtm_usr</span>, datim_password <span class="op">=</span> <span class="va">dtm_pwd</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exporting-data">Exporting Data<a class="anchor" aria-label="anchor" href="#exporting-data"></a>
</h3>
<p>If you are comfortable working in R, you can use the
<code>df_dp</code> object to munge, analyze, or visualize your data. If
you would prefer to get the data out to work with in Excel, Tableau, or
another program, we can export the data from the data frame it’s stored
in to a .csv file using the <code>readr</code> package. We will need to
tell R which object we want to export; for this we can use
<code>df_dp</code> which we got by running
<code>tame_dp(dp_filepath)</code> in the <a href="extracting-targets">Extracting Targets section</a>. You will want
to change the file name/location in the chunk below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu">write_csv</span><span class="op">(</span><span class="va">df_dp</span>,</span>
<span>                 file <span class="op">=</span> <span class="st">"../Downloads/DataPack_Jupiter_tidy.csv"</span>,</span>
<span>                 na <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Aaron Chafetz, Karishma Srikanth.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
